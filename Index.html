<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <?!= include('CSS'); ?>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    /* --- VARIÁVEIS DE CORES (O Segredo do Dark Mode) --- */
    :root {
      --bg-body: #f9f9f9;
      --bg-card: #ffffff;
      --bg-header: rgb(0, 134, 255);
      --text-primary: #333333;
      --text-secondary: #5f6368;
      --border-color: #e0e0e0;
      --hover-color: #f1f3f4;
      --active-color: #e8f0fe;
      --shadow-color: rgba(0, 0, 0, 0.1);
      --input-bg: #ffffff;
    }

    /* CORES DO MODO ESCURO */
    body.dark-mode {
      --bg-body: #121212;
      --bg-card: #1e1e1e;
      --bg-header: #005fa3;
      /* Azul um pouco mais escuro */
      --text-primary: #e0e0e0;
      --text-secondary: #b0b0b0;
      --border-color: #333333;
      --hover-color: #2c2c2c;
      --active-color: #333333;
      --shadow-color: rgba(0, 0, 0, 0.5);
      --input-bg: #2d2d2d;
    }

    /* --- GERAL --- */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Open Sans', sans-serif;
      background-color: var(--bg-body);
      color: var(--text-primary);
      overflow: hidden;
      transition: background 0.3s, color 0.3s;
    }

    /* --- CABEÇALHO --- */
    .app-header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 60px;
      background-color: var(--bg-header);
      display: flex;
      flex-direction: column;
      z-index: 2000;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    .header-content {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      position: relative;
    }

    .rainbow-line {
      height: 4px;
      width: 100%;
      background: linear-gradient(90deg, #9334e6 0%, #0b57d0 20%, #0086ff 40%, #188038 60%, #fcc934 80%, #d93025 100%);
    }

    /* ESQUERDA: APENAS LOGO */
    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
      height: 100%;
      z-index: 20;
    }

    .company-logo {
      height: 50px;
      width: auto;
      display: block;
    }

    /* CENTRO: TÍTULO */
    .header-center {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 1.4rem;
      font-weight: 700;
      pointer-events: none;
      white-space: nowrap;
    }

    /* DIREITA: TEMA + AVATAR */
    .header-right {
      display: flex;
      align-items: center;
      gap: 15px;
      height: 100%;
      z-index: 20;
    }

    .theme-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      cursor: pointer;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: 0.2s;
    }

    .theme-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .user-avatar-circle {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: white;
      color: var(--bg-header);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1rem;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    /* --- SIDEBAR --- */
    .sidebar {
      position: fixed;
      top: 64px;
      left: 0;
      width: 250px;
      height: calc(100% - 64px);
      background: var(--bg-card);
      border-right: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      transition: transform 0.3s ease, background 0.3s;
      z-index: 1000;
      padding-top: 10px;
    }

    .sidebar.hidden {
      display: none !important;
    }

    .sidebar.collapsed {
      transform: translateX(-250px);
    }

    .sidebar-footer {
      padding: 20px;
      background-color: var(--hover-color);
      border-top: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-primary);
      font-weight: 600;
      font-size: 0.70rem;
      word-break: break-all;
      /* Quebra o email se for longo */
    }

    .credits-info {
      font-size: 0.7rem;
      color: var(--text-secondary);
      border-top: 1px solid #eee;
      padding-top: 10px;
      line-height: 1.4;
      text-align: left;
    }

    .credits-info strong {
      color: #0b57d0;
      /* Azul do Faqão */
      font-weight: 700;
    }

    .credits-sub {
      display: block;
      /* Força o cargo para a linha de baixo */
      font-size: 0.7rem;
      color: var(--text-secondary);
    }

    .nav-btn {
      width: 100% !important;
      display: flex !important;
      justify-content: flex-start !important;
      align-items: center !important;
      text-align: left !important;
      padding: 12px 20px !important;
      border: none;
      background: none;
      color: var(--text-secondary);
      font-weight: 600;
      cursor: pointer;
      font-size: 0.95rem;
    }

    .nav-btn:hover {
      background-color: var(--hover-color);
      color: var(--bg-header);
    }

    .nav-btn.active {
      background-color: var(--active-color);
      color: var(--bg-header);
      border-right: 3px solid var(--bg-header);
    }

    .nav-btn .material-icons {
      margin-right: 15px !important;
      font-size: 20px;
    }

    /* --- CONTEÚDO PRINCIPAL --- */
    .main-content {
      margin-left: 250px;
      margin-top: 64px;
      padding: 20px;
      height: calc(100vh - 104px);
      overflow-y: auto;
      transition: margin-left 0.3s ease;
    }

    .main-content.full-width {
      margin-left: 0 !important;
    }

    /* Scrollbar Bonita */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-body);
    }

    ::-webkit-scrollbar-thumb {
      background: #ccc;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #bbb;
    }

    /* --- CORREÇÃO 1: CHAT E TEMPLATES (Layout) --- */
    #view-chat,
    #view-templates {
      max-width: 900px;
      /* Limita a largura para não estourar */
      margin: 0 auto;
      /* Centraliza na tela */
      padding-bottom: 50px;
      padding-top: 10px;
    }

    /* Garante que o conteúdo não entre debaixo do menu em telas menores */
    @media (max-width: 1200px) {

      #view-chat,
      #view-templates {
        margin-left: 20px;
        margin-right: 20px;
        width: auto;
      }
    }

    /* --- CORREÇÃO 2: INPUT DE PESQUISA (Lupa) --- */
    /* Aumentei o padding-left para 50px para afastar o texto da lupa */
    .search-input {
      width: 100%;
      padding: 12px 15px 12px 50px !important;
      border-radius: 24px;
      border: 1px solid var(--border-color);
      background: var(--input-bg);
      color: var(--text-primary);
      font-size: 0.95rem;
      outline: none;
      transition: 0.2s;
    }

    .search-icon-fix {
      left: 18px !important;
      /* Ajuste fino da posição do ícone */
    }

    /* --- CORREÇÃO 4: BOTÕES DO MODAL (Alinhamento) --- */
    .modal-footer {
      display: flex;
      justify-content: flex-end;
      /* Joga os botões para a direita */
      align-items: center;
      gap: 10px;
      /* Espaço entre Cancelar e Salvar */
      padding: 15px 25px;
      border-top: 1px solid var(--border-color);
      background: var(--bg-card);
    }

    /* Botão Cancelar (Cinza/Neutro) */
    .btn-secondary {
      background: var(--hover-color);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    /* Botão Salvar (Azul) */
    .btn-primary {
      background: #0b57d0;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-primary:hover {
      background: #174ea6;
    }

    .doc-container-full {
      display: flex;
      flex-direction: column;
      height: 100%;
      /* Ocupa a altura definida pelo pai */
      background-color: var(--bg-card);
      /* Usa suas variáveis */
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid var(--border-color);
    }

    .doc-iframe {
      flex: 1;
      width: 100%;
      border: none;
      background: #fff;
    }
  </style>
</head>

<body>

  <div class="app-header">
    <div class="header-content">
      <div class="header-left">
        <img
          src="data:image/png;base64,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"
          alt="LuizaLabs Logo" class="company-logo">
      </div>

      <div class="header-center">
        FAQão
      </div>

      <div class="header-right">
        <button class="theme-btn" onclick="alternarTema()" title="Alternar Tema">
          <span class="material-icons" id="icon-theme">dark_mode</span>
        </button>
        <div class="user-avatar-circle" id="user-avatar">U</div>
      </div>
    </div>
    <div class="rainbow-line"></div>
  </div>

  <div class="sidebar" id="mySidebar">
    <div style="flex: 1; overflow-y: auto; width: 100%;">
      <button class="nav-btn active" onclick="mudarAba('home', this)">
        <span class="material-icons">grid_view</span> Início
      </button>
      <button class="nav-btn" onclick="mudarAba('chat', this)">
        <span class="material-icons">smart_toy</span> Agente IA
      </button>
      <button class="nav-btn" onclick="mudarAba('scripts', this)">
        <span class="material-icons">terminal</span> Scripts Úteis
      </button>
      <button class="nav-btn" onclick="mudarAba('templates', this)">
        <span class="material-icons">description</span> Respostas Padrão
      </button>
      <button class="nav-btn" onclick="mudarAba('biblioteca', this)">
        <span class="material-icons">local_library</span> Base de Conhecimento
      </button>
      <button class="nav-btn" style="color: #7a7118;" onclick="mudarAba('Documentacao', this)">
        <span class="material-icons">article</span> Sobre
      </button>
      <button class="nav-btn" style="color: #188038;"
        onclick="window.open('https://script.google.com/a/macros/luizalabs.com/s/AKfycbwcwKziwn37TfZgEJcHA_37l9aG6prf73CL-8JZ9pMgO9igU6mEC9iTrdNI1FbtI4Kr/exec', '_blank')">
        <span class="material-icons">manage_accounts</span> Gerenciador Users
      </button>
      <button class="nav-btn" style="color: #009688;"
        onclick="window.open('https://script.google.com/a/macros/luizalabs.com/s/AKfycbxSysahiLrhnZPMJgnoce6ggmStWpw2I4I3YyrXqVu45O2plV00opX_iP7clEw17tqJRA/exec', '_blank')">
        <span class="material-icons">assignment</span> Gestão de Entregas
      </button>
      <button id="btn-admin-docs" class="nav-btn" style="display: none; color: #e37400;" onclick="navegarParaDrive()">
        <span class="material-icons">folder_shared</span> Docs Originais
      </button>

    </div>
    <div style="padding: 15px; border-top: 1px solid var(--border-color);">
      <span id="user-role" style="font-size:0.75rem; color:#137333; font-weight:bold; display:none;">
        <span class="material-icons" style="font-size:12px; vertical-align:middle">verified</span> ADMINISTRADOR
      </span>
    </div>
    <div class="sidebar-footer">

      <div class="user-info" title="Usuário Logado">
        <span class="material-icons" style="font-size:20px; color:#0b57d0;">account_circle</span>
        <span id="user-email-display">Carregando...</span>
      </div>

      <div class="credits-info">
        Produced by <strong>Genison Leal</strong>
        <span class="credits-sub"> Suporte Infra CDs</span>
      </div>
    </div>
  </div>

  <div class="main-content" id="mainArea">

    <div id="view-home" class="view-section">
      <?!= include('Home'); ?>
    </div>
    <div id="view-chat" class="view-section" style="display:none;">
      <?!= include('Chat'); ?>
    </div>
    <div id="view-scripts" class="view-section" style="display:none;">
      <?!= include('Scripts'); ?>
    </div>
    <div id="view-templates" class="view-section" style="display:none;">
      <?!= include('Templates'); ?>
    </div>
    <div id="view-biblioteca" class="view-section" style="display:none;">
      <?!= include('Biblioteca'); ?>
    </div>
    <div id="view-Documentacao" class="view-section" style="display:none; height:100%;">
      <?!= include('Documentacao'); ?>
    </div>
  </div>


  <script>
    // 1. TEMA ESCURO
    function alternarTema() {
      document.body.classList.toggle('dark-mode');
      const icon = document.getElementById('icon-theme');
      if (document.body.classList.contains('dark-mode')) {
        icon.textContent = 'light_mode';
      } else {
        icon.textContent = 'dark_mode';
      }
    }

    function navegarParaDrive() {
      console.log("Iniciando navegação para drive...");
      google.script.run
        .withSuccessHandler(function (id) {
          console.log("ID recuperado: " + id);
          if (id) {
            window.open('https://drive.google.com/drive/u/0/folders/' + id, '_blank');
          } else {
            alert('ERRO: ID da pasta não configurado no servidor. Execute o SetupConfig.');
          }
        })
        .withFailureHandler(function (e) {
          alert('Erro ao buscar ID: ' + e);
        })
        .getDriveFolderId();
    }

    // (Resto do Script de Navegação e Login igual ao anterior, apenas sem a função toggleSidebar manual)
    function mudarAba(idAba, elementoBtn) {
      var secoes = document.querySelectorAll('.view-section');
      secoes.forEach(div => div.style.display = 'none');

      var divAlvo = document.getElementById('view-' + idAba);
      if (divAlvo) divAlvo.style.display = 'block';

      if (elementoBtn) {
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        elementoBtn.classList.add('active');
      }

      const sidebar = document.getElementById('mySidebar');
      const main = document.getElementById('mainArea');

      if (idAba === 'home') {
        sidebar.classList.add('hidden');
        sidebar.classList.remove('collapsed');
        main.classList.add('full-width');
      } else {
        sidebar.classList.remove('hidden');
        main.classList.remove('full-width');
        if (window.innerWidth <= 768) {
          sidebar.classList.add('collapsed');
          main.classList.add('full-width');
        }
      }
    }

    function navegarInterno(abaDestino) {
      const botoes = document.querySelectorAll('.nav-btn');
      let botaoAlvo = null;
      botoes.forEach(btn => {
        const acao = btn.getAttribute('onclick');
        if (acao && acao.indexOf("'" + abaDestino + "'") !== -1) botaoAlvo = btn;
      });
      mudarAba(abaDestino, botaoAlvo);
    }

    (function init() {
      mudarAba('home', null);
      google.script.run.withSuccessHandler(function (email) {
        const elAvatar = document.getElementById('user-avatar');
        if (elAvatar) elAvatar.textContent = email.charAt(0).toUpperCase();
        verificarSeEhAdmin();
      }).getUsuarioAtual();
    })();

    function verificarSeEhAdmin() {
      google.script.run.withSuccessHandler(function (ehAdmin) {
        if (ehAdmin) {
          const elRole = document.getElementById('user-role');
          if (elRole) elRole.style.display = 'block';
          const btnDocs = document.getElementById('btn-admin-docs');
          if (btnDocs) btnDocs.style.display = 'flex';
          const btnAddScript = document.getElementById('btn-add-script');
          if (btnAddScript) btnAddScript.style.display = 'block';
          const btnAddTuto = document.getElementById('btn-add-tuto');
          if (btnAddTuto) btnAddTuto.style.display = 'block';
        }
      }).verificarPermissaoAdmin();
    }

    google.script.run.withSuccessHandler(function (email) {
      var display = document.getElementById('user-email-display');
      if (display) display.innerText = email;
    }).getEmailUsuario();

    // 2. Verifica se é Admin para mostrar o Badge Verde
    google.script.run.withSuccessHandler(function (isAdmin) {
      if (isAdmin) {
        // Se for admin, mostra a div que estava oculta
        document.getElementById('user-role-area').style.display = 'block';

        // Se você tiver outras lógicas de admin (mostrar botões), elas continuam aqui...
        // ex: document.getElementById('btn-add-tuto').style.display = 'flex';
      }
    }).verificarPermissaoAdmin();
  </script>
</body>

</html>